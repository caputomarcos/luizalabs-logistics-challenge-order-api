<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: services/fileService.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: services/fileService.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>const multer = require("multer");
const path = require("path");
const magaLog = require("../utils/loggingExtension"); // :-)

/**
 * Define a configuração do armazenamento para o Multer, usado para o processamento de upload de arquivos.
 * Configura a pasta de destino dos arquivos e o formato do nome de arquivo.
 *
 */
const storage = multer.diskStorage({
  /**
   * Define o destino onde os arquivos serão salvos.
   * @param {Object} req - Objeto da requisição do Express.
   * @param {Object} file - Objeto do arquivo que está sendo enviado.
   * @param {Function} cb - Função de callback para definir o destino do arquivo.
   */
  destination: function (req, file, cb) {
    cb(null, "./uploads"); // Caminho do diretório onde os arquivos serão salvos.
  },
  /**
   * Define o nome do arquivo no sistema de armazenamento.
   * @param {Object} req - Objeto da requisição do Express.
   * @param {Object} file - Objeto do arquivo que está sendo enviado.
   * @param {Function} cb - Função de callback para definir o nome do arquivo.
   */
  filename: function (req, file, cb) {
    const timestamp = Date.now();
    const filename = `${file.originalname.split(".")[0]}_${timestamp}${path.extname(file.originalname)}`;
    magaLog.log({ evemt: "diskStorage", filename: filename }); // Log do nome do arquivo para fins de debug.
    cb(null, filename); // Configura o nome do arquivo.
  },
});

/**
 * Configura as variáveis de ambiente carregadas do arquivo .env para os limites de upload.
 * @constant {Object} uploadLimits
 * @property {number} fileSize - O tamanho máximo do arquivo em bytes.
 * @property {number} files - O número máximo de arquivos permitidos.
 */
const uploadLimits = {
  /**
   * O tamanho máximo do arquivo em bytes.
   * @default
   */
  fileSize: parseInt(process.env.FILE_SIZE_LIMIT) || 10 * 1024 * 1024, // Verifica se há um valor definido no .env, caso contrário, usa o valor padrão de 10 MB

  /**
   * O número máximo de arquivos permitidos.
   * @default
   */
  files: parseInt(process.env.FILES_LIMIT) || 10, // Verifica se há um valor definido no .env, caso contrário, usa o valor padrão de 10 arquivos
};

// Configura o Multer com as definições de armazenamento especificadas.
const upload = multer({ storage: storage, limits: uploadLimits });

module.exports = {
  upload,
  storage,
  uploadLimits,
};
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Order.html">Order</a></li></ul><h3>Global</h3><ul><li><a href="global.html#destination">destination</a></li><li><a href="global.html#extractData">extractData</a></li><li><a href="global.html#filename">filename</a></li><li><a href="global.html#filterOrders">filterOrders</a></li><li><a href="global.html#getFileHash">getFileHash</a></li><li><a href="global.html#onOrderUpdated">onOrderUpdated</a></li><li><a href="global.html#options">options</a></li><li><a href="global.html#parseLegacyData">parseLegacyData</a></li><li><a href="global.html#processUploadedFiles">processUploadedFiles</a></li><li><a href="global.html#removeOrderListener">removeOrderListener</a></li><li><a href="global.html#storage">storage</a></li><li><a href="global.html#updateOrCreateOrder">updateOrCreateOrder</a></li><li><a href="global.html#uploadLimits">uploadLimits</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.3</a> on Mon May 13 2024 22:54:59 GMT-0300 (Brasilia Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
